<!DOCTYPE html><html lang="en"><head><title>Automating Development Environment Setup</title><meta name="description" content="Automating development environment setup with Vagrant and VirtualBox"><meta name="keywords" content="vagrant, development environment setup, automating, virtualbox"><meta charset="UTF-8"><meta name="author" content="Janika Liiv"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/style/normalize.css"><link rel="stylesheet" href="/style/common.css"><link rel="stylesheet" href="/style/custom.css"></head><body><nav><a alt="about" href="/" class="menu-item">About</a><a alt="articles" href="/articles" class="menu-item">Writings</a></nav><div class="content"><div class="container"><div class="item blog"><h1>Automating Development Environment Setup</h1><p>It’s Wednesday, you come to work, get a cup of coffee and power on your computer. But something terrible has happened! For some unfathomable reason, the screen of your iMac is scrambled. After multiple reboots, you have to give in, take the substitute computer and start setting up the development environment to get to work. Before you know it it’s the end of the day, and you still haven’t figured out why the pg gem doesn’t get installed and why the GOPATH doesn’t point where you want it to. Why can’t those things just work? All you want to do is to code! Not to install, remove, reinstall and configure, configure, configure… If you wanted to do that, you would be a sysadmin, but you are not. And before you know it you are frustrated, hate your work and life. And all you can do is just plough through all this and feel for the new guy who will be coming in next week and has to do the same all over again.</p><p>Or!? You could automate!</p><h3>The Goal</h3><p>The previous scenario is something that has happened to a team member of mine at Teamweek and probably to others out there as well. We decided we don’t want any of our developers to go through that set up hell again and started planning automating the process. This is what we decided we wanted to achieve:</p><ul><li>Setup should take less than an hour</li><li>Developer just has to know one command for set up</li><li>The set up has to work both on OS X and Linux</li><li>The development environment should be similar on all machines</li><li>Everyone should be able to use his/her favourite tool for writing code and browser to see the results</li></ul><h3>Tools To Use</h3><p>There doesn’t seem to be many tools for just automating the development environment setup. If you don’t want to write your own tool, there are basically two good options – Github’s <a href="https://boxen.github.com/" target="_blank">Boxen</a> or HashiCorp’s <a href="https://www.vagrantup.com/" target="_blank">Vagrant</a>.</p><p>Boxen uses Puppet scripts and they say it has roughly a bajillion libraries, which can be used for different setups. As lovely as it seems, Boxen has one downside – it only works on Mac OS X. The fact that developers in Teamweek use different operating systems and the ideal of everyone having similar development environment setup means we probably need to use a virtual machine. Which is great, because Vagrant gives us the possibility to run our environment on a local virtualised platform using VirtualBox or VMware, making it portable between Windows, Mac OS X, and Linux. For automatically installing and configuring software on the machine, it’s possible to use shell scripts, Chef or Puppet.</p><h3>Our Setup</h3><p>To get things started, you need to install Vagrant and your flavour of virtualisation platform – for us, it’s <a href="https://www.virtualbox.org/" target="_blank">VirtualBox</a>. After that, just create a project folder for the setup files and run vagrant init. This will create the default Vagrantfile where you define in clean Ruby syntax, what base box you want to use (we use ubuntu/trusty64 cause our production servers use it, but there are more available at <a href="https://atlas.hashicorp.com/boxes/search" target="_blank">Atlas</a>), which folders will be synced with the host machine and what ports forwarded.</p><p>This is how a simple Vagrantfile could look like:</p><div><div style="background: #f8f8f8; overflow:auto;width:auto;padding:.2em .3em;font-size:.8em">
  <pre style="margin: 0; line-height: 125%"><span style="color: #880000">Vagrant</span><span style="color: #666666">.</span>configure(<span style="color: #BA2121">&quot;2&quot;</span>) <span style="color: #008000; font-weight: bold">do</span> <span style="color: #666666">|</span>config<span style="color: #666666">|</span>
    config<span style="color: #666666">.</span>vm<span style="color: #666666">.</span>define <span style="color: #BA2121">&quot;app&quot;</span> <span style="color: #008000; font-weight: bold">do</span> <span style="color: #666666">|</span>v<span style="color: #666666">|</span>
      v<span style="color: #666666">.</span>vm<span style="color: #666666">.</span>box <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;ubuntu/trusty64&quot;</span>
      v<span style="color: #666666">.</span>vm<span style="color: #666666">.</span>synced_folder <span style="color: #BA2121">&quot;../projects&quot;</span>, <span style="color: #BA2121">&quot;~/projects&quot;</span>, <span style="color: #19177C">:nfs</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000">true</span>
      
      config<span style="color: #666666">.</span>vm<span style="color: #666666">.</span>provider <span style="color: #BA2121">&quot;virtualbox&quot;</span> <span style="color: #008000; font-weight: bold">do</span> <span style="color: #666666">|</span>v<span style="color: #666666">|</span>
        v<span style="color: #666666">.</span>memory <span style="color: #666666">=</span> <span style="color: #666666">2048</span>
        v<span style="color: #666666">.</span>cpus <span style="color: #666666">=</span> <span style="color: #666666">2</span>
      <span style="color: #008000; font-weight: bold">end</span>
      
      v<span style="color: #666666">.</span>vm<span style="color: #666666">.</span>network <span style="color: #BA2121">&quot;forwarded_port&quot;</span>, <span style="color: #19177C">guest</span>: <span style="color: #666666">9292</span>, <span style="color: #19177C">host</span>: <span style="color: #666666">9292</span>
      v<span style="color: #666666">.</span>vm<span style="color: #666666">.</span>provision <span style="color: #19177C">:shell</span>, <span style="color: #19177C">path</span>: <span style="color: #BA2121">&quot;system_setup.sh&quot;</span>
      v<span style="color: #666666">.</span>vm<span style="color: #666666">.</span>provision <span style="color: #19177C">:shell</span>, <span style="color: #19177C">path</span>: <span style="color: #BA2121">&quot;user_setup.sh&quot;</span>, <span style="color: #19177C">privileged</span>: <span style="color: #008000">false</span>
    <span style="color: #008000; font-weight: bold">end</span>
  <span style="color: #008000; font-weight: bold">end</span>
  </pre>
</div>

</div><p>For provisioning we have chosen good old shell scripting and for the sake of cleanliness, have separated system, user and project setups in different files and folders. The scripts install all prerequisites we need to run and develop our applications, pulls projects from git to the synced folder, creates shared secrets, sets up the database and environment specific configurations for every project</p><p>To get it all working means a lot of trial and error for one developer, but in the long run it pays off. Especially when others can start using it. All they have to do is pull the Vagrant project from version control, install Vagrant and VirtualBox and run vagrant up. After that, the developer can ssh to the machine with vagrant ssh and start working. As the source code of projects is in the synced folder, it’s possible to code with whatever editor in the host machine and thanks to the forwarded ports, it’s possible to see the results with the coders favourite browser.</p><h3>Some Pitfalls</h3><p>Using Vagrant is no picnic either. There were several weird problems we encountered trying to set it up. For one thing ssh to a virtual machine can give you a SSH Timeout, if you don’t have Intel Virtualisation enabled in host machine’s BIOS. Not sure if it’s the correct thing to do, but this is what did the trick for us.</p><p>VirtualBox’s default shared folder implementation had high performance penalties for us, so to speed things up, we <a href="https://docs.vagrantup.com/v2/synced-folders/nfs.html" target="_blank">switched to NFS</a>, which means you need to install NFS support to your host machine, if you are not using OS X.</p><p>With NFS there were some weird problems syncing to an encrypted home folder under Ubuntu, but this can be fixed by moving the host machine’s sync folder outside the /home folder.</p><p>The virtual machine can be speed up by changing the memory and cpu settings in vagrant configuration. Using 1/4 of your system memory and using the number of CPU cores the host machine has, seems to be a reliable setting for us.</p><p>Nevertheless for some machines vagrant keeps eating up host’s memory and we are still trying to figure out what the problem may be.</p><h3>The Result</h3><p>To recap, this is what we gained:</p><ul><li>Faster setup</li><li>Developers working in a similar environment</li><li>Environment set up process is documented</li><li>Onboarding of new developers faster</li><li>Operating system upgrades not so scary anymore</li></ul><p>The majority of our team seems to be happy with Vagrant. For me personally, it has made life easier. Also getting a new team member on board is faster and easier as the setup time of the development environment has reduced from days to approximately an hour. It’s possible to make it faster, but compared to what we had to deal with before, it’s quite good.</p><p>Another great thing is that we now have a documented set up process. Having moved away from monolithic Rails application, we now have around 12 small services, which use different technologies and require environment dependent configuration. This means means a lot more stuff to remember. But who has time for that?! So even if a developer chooses not use Vagrant, they can get a pretty good idea how to set up the environment on their machine from reading the source code of the Vagrant project.</p><p>Although when creating new projects or changing configuration settings of existing ones, we now have to also update the Vagrant project, but on the other hand it’s a lot easier than to tell a bunch of developers what and where they need to change or install on different platforms.</p><p>All in all, we are quite content with our choice of environment setup automation tool. Let’s see if it sticks.</p><p><em> 
This is a revised version of my writing, which was originally published in <a href="http://blog.teamweek.com" target="_blank">Teamweek blog </a>under the name <a href="http://blog.teamweek.com/2015/01/automating-development-environment-setup/" target="_blank">Automating Development Environment Setup </a>in January 2015.</em></p></div></div></div></body></html>